{{>layouts/header}}

<div
    class="d-flex flex-column justify-content-center align-items-center"
    style="background-image: url('/images/MainDevMatchOpacity.png'); background-size: cover; background-position: center; width: 100%; height: 600px; margin-top: 5rem; margin-bottom: 10rem;"
>
    <div class="bg-white d-flex flex-column justify-content-center align-items-center rounded" style="width: 350px; height: 600px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">
        <img src="/images/DevMatchLogo.png" alt="Logo" width="120px" style="margin-bottom: 30px"/>
        <form class="d-flex flex-column justify-content-center align-items-center" style="margin-bottom: 10px" id="loginForm">
            <div style="margin-bottom: 10px">
                <label style="width: 80px; padding-right: 8px;">아이디:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div style="margin-bottom: 10px">
                <label style="width: 80px; padding-right: 8px;">비밀번호:</label>
                <input type="password" id="password"  name="password" required>
            </div>
            <p id="errorMsg" style="color:red; display: none;"></p>
            <button style="background-color: #0076D7; color: white; width: 270px;" type="submit" class="btn btn-primary">로그인</button>
        </form>
        <a href="/signup" class="ms-auto" style="margin-right: 45px">회원가입</a>
    </div>
</div>

<script>
    const form = document.getElementById('loginForm');
    const errorMsg = document.getElementById('errorMsg');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value.trim();
        const password = document.getElementById('password').value.trim();

        try {
            const response = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });

            if (!response.ok) {
                const errorText = await response.text();
                errorMsg.style.display = 'block';
                errorMsg.textContent = errorText;
                return;
            }

            // 로그인 성공 후 홈으로 이동
            window.location.href = '/';
        } catch (error) {
            errorMsg.style.display = 'block';
            errorMsg.textContent = '로그인 요청 중 오류가 발생했습니다.';
        }
    });
</script>

{{>layouts/footer}}